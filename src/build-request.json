{
  "kind": "build_request",
  "title": "Add pickup/dropoff address-based distance calculation and enforce $10 deposit + $25 fee for trips up to 10 miles (including Shopping)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the customer booking flow UI to collect both pickup and dropoff addresses and calculate an estimated distance (miles) from pickup and dropoff coordinates when available. Provide a clear UI action to capture coordinates for both pickup and dropoff (e.g., a “Use current location” / GPS button for each address), and show the calculated miles in the cost breakdown.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add where they can add the address for pick up and drop off  to calculate the mileage"
        ]
      },
      "acceptanceCriteria": [
        "Booking UI includes required inputs for Pickup address and Dropoff address.",
        "Booking UI provides a way to capture/set pickup coordinates and dropoff coordinates from the browser (when permitted).",
        "When both pickup and dropoff coordinates exist, the UI displays a calculated distance in miles and uses it as the trip’s estimated/recorded distance for pricing validation.",
        "If coordinates are unavailable, the UI clearly indicates that distance cannot be calculated and blocks submission (or requires the user to set coordinates) for distance-based pricing."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Implement pricing rules for distance up to 10 miles: charge a $10 non-refundable deposit and a $25 service fee (total $35) for eligible bookings, and apply the same pricing rule to the Shopping booking flow (Shopping services). If the calculated distance is greater than 10 miles, prevent checkout/booking submission and show an English validation message stating that pricing is only supported up to 10 miles at this time.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "for distance up to 10 miles the fee is $10 deposit non refundable even if they cancel the service, and $25  for service fee. And it is same for the shopping ."
        ]
      },
      "acceptanceCriteria": [
        "For eligible bookings with distance <= 10 miles, the displayed deposit is $10 and the displayed service fee is $25, and the total shown is $35.",
        "For Shopping services, the same distance <= 10 miles rule results in the same $10 deposit + $25 service fee pricing.",
        "If calculated distance > 10 miles, the UI blocks submission and shows an English error message indicating bookings are limited to 10 miles.",
        "The Stripe checkout line items reflect the $10 deposit (in cents) and do not include any additional mileage charges for the <=10 mile case."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Make the non-refundable deposit policy explicit in the booking UI: add English user-facing copy in the booking cost breakdown and/or confirmation area stating that the $10 deposit is non-refundable even if the customer cancels the service.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "$10 deposit non refundable even if they cancel the service"
        ]
      },
      "acceptanceCriteria": [
        "The booking UI clearly states in English that the deposit is non-refundable even if the service is canceled.",
        "The copy is displayed before the user is redirected to Stripe checkout."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Persist the computed distance and pickup/dropoff address details on the Trip record created for these bookings, ensuring backend Trip.distance (Float) and Trip.locationDetails (pickupAddress/dropoffAddress and coordinates when available) are populated consistently from the booking flow.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add where they can add the address for pick up and drop off  to calculate the mileage"
        ]
      },
      "acceptanceCriteria": [
        "When a booking is created, the Trip stored in the backend includes pickupAddress and dropoffAddress in locationDetails.",
        "When coordinates are captured, pickupCoordinates and dropoffCoordinates are stored in locationDetails.",
        "Trip.distance is set (non-null) for distance-based bookings created through the updated flow."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor (all logic in backend/main.mo).",
    "Do not edit files under frontend immutablePaths; compose existing UI components instead of modifying their sources.",
    "Use English for all user-facing text introduced by this change."
  ],
  "nonGoals": [
    "Do not integrate external geocoding or mapping APIs (no Google Maps, Mapbox, etc.).",
    "Do not implement pricing rules for distances greater than 10 miles (beyond blocking/validation messaging).",
    "Do not add third-party real-time features (WebSockets, push notifications, etc.)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}